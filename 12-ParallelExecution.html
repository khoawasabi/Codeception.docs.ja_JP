
<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Codeception.docs.ja : Codeception docs japanese translation">

    <link rel="stylesheet" type="text/css" media="screen" href="//piccagliani.github.io/Codeception.docs.ja_JP/stylesheets/stylesheet.css">

    <title>Codeception.docs.ja</title>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="inner">
        <a id="forkme_banner" href="https://github.com/piccagliani/Codeception.docs.ja_JP">View on GitHub</a>

        <h1 id="project_title">Codeception.docs.ja</h1>
        <h2 id="project_tagline">Codeception docs japanese translation</h2>

        <section id="downloads">
            <a class="zip_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/zipball/master">Download this project as a .zip file</a>
            <a class="tar_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/tarball/master">Download this project as a tar.gz file</a>
        </section>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
        <h1>並列実行</h1>

<p>テストの実行時間がコーヒーブレイクよりも長くなったとしたら、それはテストの実行速度向上を考える良い機会です。もしすでにテストをSSD上で実行している、またはSeleniumの替わりにPhantomJSの使用を試しているのに、まだ実行速度にイライラしているようでしたら、テストを並列実行してみるのが良いかもしれません。</p>

<h2>どこからはじめよう？</h2>

<p>Codeceptionは <code>run-parallel</code> のようなコマンドを提供していません。全員にとって満足に動作する共通の解決策はありません。あなたは次の疑問を解決する必要があります。</p>

<ul>
<li>どのようにして並列プロセスは実行されるのか？</li>
<li>どのようにして並列プロセスがお互いに影響を与えないようにするか？</li>
<li>プロセス毎に異なるデータベースを使用するか？</li>
<li>プロセス毎に異なるホストを使用するか？</li>
<li>どのように並列プロセス間でテストを分割すべきか？</li>
</ul>

<p>これらのどの疑問に対しても、適切な1つの答えというのはありません。その代わりに、我々はあなたのニーズに沿うように構成することができ、簡単にカスタマイズ可能なソリューションを提供します。また、参考となるいくつかのアイディアについても共有します。</p>

<h2>なにをすればいい？</h2>

<p>並列テスト実行は以下の3ステップから構成されます。</p>

<ul>
<li>テストを分割する</li>
<li>テストを並列に実行する</li>
<li>テスト結果をマージする</li>
</ul>

<p>これらのステップの実施にタスクランナーを利用することを提案します。このガイドでは <a href="http://robo.li"><strong>Robo</strong></a> というタスクランナーを使用します。これは非常に簡単に利用できるモダンなPHPのタスクランナーです。バックグラウンドおよび並列プロセスの起動に <a href="http://symfony.com/doc/current/components/process.html">Symfony Process</a> を使っています。ステップ2に必要なのはこれだけです！ではステップ1とステップ2はどうでしょう？我々はテストをグループに分割するのと、テスト結果をJUnit XMLレポートにマージするために robo <a href="https://github.com/Codeception/robo-paracept">tasks</a> を作成しました。</p>

<p>まとめると、我々に必要なものは以下となります。</p>

<ul>
<li><a href="http://robo.li">Robo</a> - タスクランナー</li>
<li><a href="https://github.com/Codeception/robo-paracept">robo-paracept</a> - 並列実行のためのCodeceptionタスク</li>
</ul>

<h2>Roboを準備する</h2>

<p><code>Robo</code> はグローバルインストールすることを推奨します。<a href="https://getcomposer.org/doc/03-cli.md#global">Composerを使用してグローバルインストールする</a>か、<code>robo.phar</code> をダウンロードしてPATHを通すか、どちらでも構いません。</p>

<p>プロジェクトのルートで <code>robo</code> を実行します。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>robo
  RoboFile.php not found in this dir
  Should I create RoboFile here? <span class="o">(</span>y/n<span class="o">)</span>
</code></pre></div>
<p><code>RoboFile.php</code> が作成されることを確認します。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">RoboFile</span> <span class="k">extends</span> <span class="nx">\Robo\Tasks</span>
<span class="p">{</span>
    <span class="c1">// define public methods as commands</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Composer経由で <code>codeception/robo-paracept</code> をインストールし、RoboFile にインクルードします。</p>

<p>robofileの各publicメソッドはコンソールコマンドとして実行することができます。先ほどの3つのステップのコマンドを定義しましょう。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Robofile</span> <span class="k">extends</span> <span class="nx">\Robo\Tasks</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">\Codeception\Task\MergeReports</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">\Codeception\Task\SplitTestsByGroups</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">parallelSplitTests</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">parallelRun</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">parallelMergeResults</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p><code>robo</code> を実行すると、それぞれのコマンドが表示されます。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>robo
Robo version 0.4.4
---
Available commands:
  <span class="nb">help                     </span>Displays <span class="nb">help </span><span class="k">for</span> a <span class="nb">command</span>
<span class="nb">  </span>list                     Lists commands
parallel
  parallel:merge-results   
  parallel:run             
  parallel:split-tests     
</code></pre></div>
<h2>サンプルプロジェクト</h2>

<p>とても時間のかかる受け入れテストを5プロセスに分割して実行することを考えてみましょう。それぞれのテストが衝突しないように異なるホストとデータベースを使用すべきです。そのため、先に進む前に5つの異なるホストにApache/Nginxを設定する必要があります（もしくは、単に異なるポートを使用してPHPのビルトインサーサーバでアプリケーションを実行します）。ホスト情報に基づいて対応するデータベースを使用するようにしてください。</p>

<p>代替として　<a href="https://www.docker.io/">Docker</a> や <a href="https://linuxcontainers.org/">LXC</a> を使用して <strong>分離された環境</strong> を準備し、それぞれのテストプロセスをコンテナー上で実行することもできます。新しいコンテナを起動してより多くのプロセスを実行することは、手動で追加のデータベースとホストを作成するよりもはるかに簡単です。これはより安定したテスト環境を作成しているということです（データベース、ファイル、プロセスの衝突はありません）。ただ、新しく仮想マシンを作成する度にコンテナをプロビジョニングする必要があるでしょう。</p>

<p>SSHを使用してリモートホスト上でテストを実行するということも考えられます。<code>Robo</code> はSSHコマンドを実行するためのビルトインタスクも備えています。</p>

<p>このサンプルプロジェクトでは、アプリケーションのために5つのデータべースと5つの独立したホストを準備していることを想定しています。</p>

<h3>ステップ 1: テストを分割する</h3>

<p>Codeceptionはテストを <a href="http://codeception.com/docs/07-AdvancedUsage#Groups">グループ</a> に整理することができます。バージョン2.0からはグループの情報をファイルから読み込むことができます。テキストファイルにファイルの一覧を記述すると、動的にグループとして設定されます。サンプルのグループファイルを見てみましょう。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">tests/functional/LoginCept.php
tests/functional/AdminCest.php:createUser
tests/functional/AdminCest.php:deleteUser
</code></pre></div>
<p><code>\Codeception\Task\SplitTestsByGroups</code> タスクは交差しない（non-intersecting）グループファイルを生成します。テストはファイル単位、テスト単位のどちらでも分割することができます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">parallelSplitTests</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taskSplitTestFilesByGroups</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">projectRoot</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">testsFrom</span><span class="p">(</span><span class="s1">&#39;tests/functional&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">groupsTo</span><span class="p">(</span><span class="s1">&#39;tests/_log/p&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>

        <span class="c1">// alternatively</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taskSplitTestsByGroups</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">projectRoot</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">testsFrom</span><span class="p">(</span><span class="s1">&#39;tests/functional&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">groupsTo</span><span class="p">(</span><span class="s1">&#39;tests/_log/p&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
    <span class="p">}</span>    
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>後者の場合、<code>Codeception\TestLoader</code> が使用され、テストクラスはメモリ上に読み込まれます。</p>

<p>グループファイルを準備しましょう。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>robo parallel:split-tests

 <span class="o">[</span>Codeception<span class="se">\T</span>ask<span class="se">\S</span>plitTestFilesByGroupsTask<span class="o">]</span> Processing <span class="m">33</span> files
 <span class="o">[</span>Codeception<span class="se">\T</span>ask<span class="se">\S</span>plitTestFilesByGroupsTask<span class="o">]</span> Writing tests/_log/p1
 <span class="o">[</span>Codeception<span class="se">\T</span>ask<span class="se">\S</span>plitTestFilesByGroupsTask<span class="o">]</span> Writing tests/_log/p2
 <span class="o">[</span>Codeception<span class="se">\T</span>ask<span class="se">\S</span>plitTestFilesByGroupsTask<span class="o">]</span> Writing tests/_log/p3
 <span class="o">[</span>Codeception<span class="se">\T</span>ask<span class="se">\S</span>plitTestFilesByGroupsTask<span class="o">]</span> Writing tests/_log/p4
 <span class="o">[</span>Codeception<span class="se">\T</span>ask<span class="se">\S</span>plitTestFilesByGroupsTask<span class="o">]</span> Writing tests/_log/p5
</code></pre></div>
<p>これでグループファイルができました。生成されたグループファイルを読み込むよう、<code>codeception.yml</code> を更新してください。今回の場合、<em>p1</em>、 <em>p2</em>、 <em>p3</em>、 <em>p4</em>、 <em>p5</em> のグループがあります。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">groups</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">p*</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tests/_log/p*</span>
</code></pre></div>
<p>2つ目のグループからテストを実行してみましょう。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar run functional -g p2
</code></pre></div>
<h3>ステップ 2: テストを実行する</h3>

<p>すでに述べたように、Roboにはバックグラウンドプロセスを起動するための <code>ParallelExec</code> を備えています。しかし、これが唯一のオプションとは考えないでください。たとえば、SSHを介してリモートでテストを実行することもできますし、GearmanやRabbitMQなどを利用してプロセスを起動することもできます。ただ、この例では5つのバックグラウンドプロセスを利用します。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">parallelRun</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$parallel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taskParallelExec</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>            
            <span class="nv">$parallel</span><span class="o">-&gt;</span><span class="na">process</span><span class="p">(</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taskCodecept</span><span class="p">()</span> <span class="c1">// use built-in Codecept task</span>
                <span class="o">-&gt;</span><span class="na">suite</span><span class="p">(</span><span class="s1">&#39;acceptance&#39;</span><span class="p">)</span> <span class="c1">// run acceptance tests</span>
                <span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s2">&quot;p</span><span class="si">$i</span><span class="s2">&quot;</span><span class="p">)</span>        <span class="c1">// for all p* groups</span>
                <span class="o">-&gt;</span><span class="na">xml</span><span class="p">(</span><span class="s2">&quot;tests/_log/result_</span><span class="si">$i</span><span class="s2">.xml&quot;</span><span class="p">)</span> <span class="c1">// save XML results</span>
            <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$parallel</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x">    </span>
</code></pre></div>
<p>我々は何か重要なことを見落としています。異なるプロセスに異なるデータベースを定義することを忘れていますね。これは <a href="http://codeception.com/docs/07-AdvancedUsage#Environments">環境</a> を利用して行うことができます。<code>acceptance.suite.yml</code> に新しく5つの環境を定義しましょう。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AcceptanceTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">WebDriver</span><span class="p-Indicator">,</span> <span class="nv">Db</span><span class="p-Indicator">]</span>
    <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Db</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">dsn</span><span class="p-Indicator">:</span> <span class="s">&#39;mysql:dbname=testdb;host=127.0.0.1&#39;</span> 
            <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="s">&#39;root&#39;</span>
            <span class="l-Scalar-Plain">dump</span><span class="p-Indicator">:</span> <span class="s">&#39;tests/_data/dump.sql&#39;</span>
            <span class="l-Scalar-Plain">populate</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
            <span class="l-Scalar-Plain">cleanup</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
        <span class="l-Scalar-Plain">WebDriver</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="s">&#39;http://localhost/&#39;</span>
<span class="l-Scalar-Plain">env</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">p1</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">Db</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">dsn</span><span class="p-Indicator">:</span> <span class="s">&#39;mysql:dbname=testdb_1;host=127.0.0.1&#39;</span> 
                <span class="l-Scalar-Plain">WebDriver</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="s">&#39;http://test1.localhost/&#39;</span>
    <span class="l-Scalar-Plain">p2</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">Db</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">dsn</span><span class="p-Indicator">:</span> <span class="s">&#39;mysql:dbname=testdb_2;host=127.0.0.1&#39;</span> 
                <span class="l-Scalar-Plain">WebDriver</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="s">&#39;http://test2.localhost/&#39;</span>
    <span class="l-Scalar-Plain">p3</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">Db</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">dsn</span><span class="p-Indicator">:</span> <span class="s">&#39;mysql:dbname=testdb_3;host=127.0.0.1&#39;</span> 
                <span class="l-Scalar-Plain">WebDriver</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="s">&#39;http://test3.localhost/&#39;</span>
    <span class="l-Scalar-Plain">p4</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">Db</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">dsn</span><span class="p-Indicator">:</span> <span class="s">&#39;mysql:dbname=testdb_4;host=127.0.0.1&#39;</span> 
                <span class="l-Scalar-Plain">WebDriver</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="s">&#39;http://test4.localhost/&#39;</span>
    <span class="l-Scalar-Plain">p5</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">Db</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">dsn</span><span class="p-Indicator">:</span> <span class="s">&#39;mysql:dbname=testdb_5;host=127.0.0.1&#39;</span> 
                <span class="l-Scalar-Plain">WebDriver</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="s">&#39;http://test5.localhost/&#39;</span>
</code></pre></div>
<p>そうしたら、対応する環境を利用するように <code>parallelRun</code> メソッドを更新してください。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">parallelRun</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$parallel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taskParallelExec</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>            
            <span class="nv">$parallel</span><span class="o">-&gt;</span><span class="na">process</span><span class="p">(</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taskCodecept</span><span class="p">()</span> <span class="c1">// use built-in Codecept task</span>
                <span class="o">-&gt;</span><span class="na">suite</span><span class="p">(</span><span class="s1">&#39;acceptance&#39;</span><span class="p">)</span> <span class="c1">// run acceptance tests</span>
                <span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s2">&quot;p</span><span class="si">$i</span><span class="s2">&quot;</span><span class="p">)</span>        <span class="c1">// for all p* groups</span>
                <span class="o">-&gt;</span><span class="na">env</span><span class="p">(</span><span class="s2">&quot;p</span><span class="si">$i</span><span class="s2">&quot;</span><span class="p">)</span>          <span class="c1">// in its own environment</span>
                <span class="o">-&gt;</span><span class="na">xml</span><span class="p">(</span><span class="s2">&quot;tests/_log/result_</span><span class="si">$i</span><span class="s2">.xml&quot;</span><span class="p">)</span> <span class="c1">// save XML results</span>
              <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$parallel</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x">    </span>
</code></pre></div>
<p>これで次のようにテストを実行することができます。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>robo parallel:run
</code></pre></div>
<h3>ステップ 3: テスト結果をマージする</h3>

<p>テスト実行中はコンソールに出力される内容を信用すべきではありません。<code>parallelExec</code> タスクの場合、いくつかの文字列は失われるでしょう。テスト結果は、マージできて継続的インテグレーションに挿入できるJUnit XML形式で保存することをおすすめします。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">parallelMergeResults</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$merge</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taskMergeXmlReports</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$merge</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s2">&quot;/tests/_log/result_</span><span class="si">$i</span><span class="s2">.xml&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$merge</span><span class="o">-&gt;</span><span class="na">into</span><span class="p">(</span><span class="s2">&quot;/tests/_log/result.xml&quot;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p><code>result.xml</code> ファイルが生成されます。これを処理して、分析することができます。</p>

<h3>すべてを統合する</h3>

<p>これまでのステップを統括して1つのコマンドとするために、新しくpublicな <code>parallelAll</code> メソッドを定義し、全てのコマンドを実行するようにします。<code>parallelRun</code> の結果を保存して、最終的な終了コードとして使います。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">parallelAll</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parallelSplitTests</span><span class="p">();</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parallelRun</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parallelMergeResults</span><span class="p">();</span>
        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<h2>まとめ</h2>

<p>Codeceptionはテストを並列実行するためのツールを提供していません。これは複雑なタスクであり、解決策はプロジェクトに依存しています。我々はすべての必要なステップを行うために外部ツールとしての <a href="http://robo.li">Robo</a> タスクランナーを使いました。テストを並列実行するための準備としてCodeceptionの動的グループと環境の仕組みを利用しました。さらに、テストプロセスに応じて動的な設定を行うための拡張機能とグループクラスを作成することができます。</p>

    </section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="inner">
        <p class="copyright">Codeception.docs.ja maintained by <a href="https://github.com/piccagliani">piccagliani</a></p>
        <p>Last updated: 2015-02-23 14:09:44 +0900, Based on <a href="https://github.com/Codeception/Codeception/tree/2.0">Codeception</a>@4e267293bb</p>
        <div id="contributors"></div>
    </footer>
</div>

<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-59804278-1");
        pageTracker._trackPageview();
    } catch(err) {}
</script>
<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="//piccagliani.github.io/Codeception.docs.ja_JP/javascripts/contributors.js"></script>

</body>
</html>
