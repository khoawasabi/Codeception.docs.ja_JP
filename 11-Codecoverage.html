
<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Codeception.docs.ja : Codeception docs japanese translation">

    <link rel="stylesheet" type="text/css" media="screen" href="//piccagliani.github.io/Codeception.docs.ja_JP/stylesheets/stylesheet.css">

    <title>Codeception.docs.ja</title>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="inner">
        <a id="forkme_banner" href="https://github.com/piccagliani/Codeception.docs.ja_JP">View on GitHub</a>

        <h1 id="project_title">Codeception.docs.ja</h1>
        <h2 id="project_tagline">Codeception docs japanese translation</h2>

        <section id="downloads">
            <a class="zip_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/zipball/master">Download this project as a .zip file</a>
            <a class="tar_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/tarball/master">Download this project as a tar.gz file</a>
        </section>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
        <h2>コードカバレッジ</h2>

<p>あるタイミングでアプリケーションのどの箇所がテストされていて、どの箇所がテストされていないのか確認したくなると思います。
そのような状況に<a href="http://ja.wikipedia.org/w/index.php?title=%E3%82%B3%E3%83%BC%E3%83%89%E3%82%AB%E3%83%90%E3%83%AC%E3%83%83%E3%82%B8">コードカバレッジ</a>が使われます。
カバレッジレポートを収集するためにテストを実行すると、そのテストによって実行された全てのクラス、メソッド、そして行の統計情報を取得します。
スクリプトの全行数と通過した行数との比率が、主要なカバレッジ基準となります。理想論では100%のカバレッジを取得する必要がありますが、実際には80%で十分でしょう。なぜなら、100%のカバレッジであったとしても致命的なエラーやクラッシュを防ぐことができないからです。</p>

<p><strong>Codeceptionはバージョン1.5からコードカバレッジ用のツールを備えています。カバレッジを収集するためには <code>xdebug</code> が必要となります。</strong>.</p>

<p><img src="http://codeception.com/images/coverage.png" alt="コードカバレッジの例"></p>

<p>カバレッジデータはローカルとリモートの両方のテストのために手動で収集することができます。
リモートのテストは、異なるノード上またはローカルのWebサーバーを利用して実行可能です。
SeleniumやPhpBrowserによるテストはコードカバレッジを収集するのは難しいように見えるかもしれませんが、Codeceptionはローカルと同じようにリモートのコードカバレッジをサポートしています。</p>

<h3>設定</h3>

<p>コードカバレッジを有効にするためには次の内容をグローバル設定ファイル <code>codeception.yml</code> に設定します。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">coverage</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</code></pre></div>
<p>今はこれで大丈夫ですが、最終的なカバレッジレポートにはどのファイルが表示されるべきなのでしょうか？次のように、ブラックリストとホワイトリストのフィルタを提供することで、ファイルをフィルタリングすることができます。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">coverage</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">whitelist</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">include</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">app/*</span>
        <span class="l-Scalar-Plain">exclude</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">app/cache/*</span>
    <span class="l-Scalar-Plain">blacklist</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">include</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">app/controllers/*</span>
        <span class="l-Scalar-Plain">exclude</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">app/cache/CacheProvider.php</span>
</code></pre></div>
<p>ホワイトリストとブラックリストはなんでしょうか？</p>

<ul>
<li><strong>whitelist</strong> 通過しなかったとしてもレポートに含まれるべきファイルの一覧です</li>
<li><strong>blacklist</strong> 通過したとしてもレポートから除外すべきファイルの一覧です</li>
</ul>

<p>include/excludeセクションにファイルまたはディレクトリの配列を渡します。&#39;*&#39; で終わるパスはディレクトリにマッチします。
また、&#39;*&#39; マスクをファイル名に使用することができます。たとえば、<code>app/models/*Model.php</code> はすべてのモデルにマッチします。</p>

<p>There is a shortcut if you don&#39;t need that complex filters:
複雑なフィルタが必要ない場合のショートカットがあります。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">coverage</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">include</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">app/*</span>
    <span class="l-Scalar-Plain">exclude</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">app/cache/*</span>
</code></pre></div>
<p>この <code>include</code> と <code>exclude</code> オプションはホワイトリストにファイルを追加または削除するためのものです。</p>

<p>以上のすべての設定は各テストスイートの設定ファイルにて再定義することができます。</p>

<h2>ローカルコードカバレッジ</h2>

<p>基本的なコードカバレッジは機能テストと単体テストで収集することができます。
もし上に書いた設定を行っているのであれば準備完了です。
必要なことはCodeceptionを <code>--coverage</code> オプションとともに実行することです。</p>

<p>CloverのXMLレポートや良い感じのHTMLレポートを生成するためには、<code>--coverage-xml</code> と <code>--coverage-html</code> のオプションについても追加します。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">codecept run --coverage --coverage-xml --coverage-html</span>
</code></pre></div>
<p>XMLとHTMLレポートは <code>_output</code> ディレクトリに格納されます。レポートを確認するための一番の方法は、<code>tests/_output/coverage</code> ディレクトリから <code>index.html</code> をブラウザで開くことです。
CloverのXMLレポートはPHPStormのようなIDEやJenkinsのような継続的インテグレーションサーバーで利用されます。</p>

<h2>リモートコードカバレッジ</h2>

<h3>ローカルサーバー</h3>

<p>もしアプリケーションをウェブサーバー（Apache, Nginx, PHP WebServer）を介して実行している場合、テストされたコードに直接アクセスすることができないため、
カバレッジを収集することは簡単なことではありません。同様のことが、異なるノード上でテストされたスクリプトに対しても言えます。
これらのコードにアクセスするためには <code>xdebug</code> を <code>remote_enable</code> オプションを有効にしてインストールする必要があります。
Codeceptionもまた、アプリケーションとやり取りするためのちょっとしたスパイを必要とします。
スタンドアローンでアプリケーションを実行する際に、テストされているかどうかに関わらず、コードカバレッジ情報を収集するために小さなファイルをインクルードしてください。</p>

<p>このファイルは <code>c3.php</code> と呼ばれ、<a href="https://github.com/Codeception/c3">GitHubから利用可能</a> です。
<code>c3.php</code> をダウンロードし、アプリケーションのコントローラの最初でインクルードしてください。
特別なヘッダー情報を送信することにより、Codeceptionはアプリケーションに対して、いつコードカバレッジの収集を開始し、いつ終了するか命令します。
テストスイートが終了した後、レポートが出力され、Codeceptionはアプリケーションからそれを取得します。</p>

<p>インストール方法は <a href="https://github.com/Codeception/c3">readme file</a> の説明に従ってください。</p>

<p><code>c3</code> への接続のために、CodeceptionはPhpBrowserやWebDriverモジュールのURL設定を利用しますが、
<code>c3.php</code> がインクルードされるインデックスファイルのURLを <code>c3_url</code> パラメータにより明示的に指定することができます。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">coverage</span><span class="p-Indicator">:</span>
    <span class="c1"># url of file which includes c3 router.</span>
    <span class="l-Scalar-Plain">c3_url</span><span class="p-Indicator">:</span> <span class="s">&#39;http://127.0.0.1:8000/index-test.php/&#39;</span>
</code></pre></div>
<p><code>c3.php</code> がアプリケーションにインクルードされたのち、カバレッジの収集を開始することができます。
ローカルでアプリケーションを実行する場合に変更となる設定はありません。
すべてのコードカバレッジレポートは普段どおり収集され、その後マージされます。
考えてみてください、Codeceptionはローカルと同じようにリモートカバレッジを実行できるのです。</p>

<h3>リモートサーバー</h3>

<p>もしテストを異なるサーバー上で実行している場合（もしくはウェブサーバーがカレントディレクトリのコードを使用していない場合）、設定ファイルに <code>remote</code> オプションを追加してください。
たとえば、受け入れテストでのリモートカバレッジを <code>acceptance.suite.yml</code> にて有効にしてみます。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">coverage</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">remote</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</code></pre></div>
<p>このオプションが有効となった場合、リモートコードカバレッジの結果はローカルのものとマージされません。
リモートとローカルのファイル群が同じパス上に存在する場合のみマージは行われます。
けれども、リモートサーバー上でテストを行う場合、同じパス上に存在するかどうかはわかりません。</p>

<p>リモートサーバーからのコードカバレッジの結果は <code>tests/_output</code> に保存されます。すでに述べた理由により、コンソールにはコードカバレッジの結果が表示されないことに注意してください。ローカルとリモートの結果はマージされませんし、コンソールにはローカルのコードカバレッジの結果が表示されます。</p>

<h3>リモートコンテキストオプション</h3>

<p>HTMLレポートの生成にはデフォルトのタイムアウト30秒よりも少し時間がかかることがあります。また、SSLの設定を変更したい場合があるかもしれません（たとえばveryfy<em>peerオプション）
c3がウェブサーバー（ローカル、リモートのどちらであろうとも）に対してサービス要求をする方法を変更するには、<code>coverage</code> 設定の remote</em>context_options` キーを使用します。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">coverage</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">remote_context_options</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">http</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">timeout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">60</span>
        <span class="l-Scalar-Plain">ssl</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">verify_peer</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</code></pre></div>
<p>コンテキストオプションについては<a href="http://php.net/manual/ja/context.php">php.netのドキュメント</a>に良くまとまっています。</p>

<h2>まとめ</h2>

<p>ローカルとリモートのコードカバレッジ設定はこれまでになく簡単です。たった1つの設定を行い、1ファイルをインクルードするだけです！
<strong>Codeceptionを使えばSeleniumテストのコードカバレッジレポートを簡単に生成することができます</strong> （他の受け入れテストやAPIテストについても）。<code>acceptance</code>、<code>functional</code>、そして <code>unit</code> の各スイートが統合されたレポートは、アプリケーションのどの箇所がテストされていて、どの箇所がテストされていないのか、最も完全な情報を提供します。</p>

    </section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="inner">
        <p class="copyright">Codeception.docs.ja maintained by <a href="https://github.com/piccagliani">piccagliani</a></p>
        <p>Last updated: 2015-02-23 15:02:04 +0900, Based on <a href="https://github.com/Codeception/Codeception/tree/2.0">Codeception</a>@4e267293bb</p>
        <div id="contributors"></div>
    </footer>
</div>

<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-59804278-1");
        pageTracker._trackPageview();
    } catch(err) {}
</script>
<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="//piccagliani.github.io/Codeception.docs.ja_JP/javascripts/contributors.js"></script>

</body>
</html>
