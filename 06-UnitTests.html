
<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Codeception.docs.ja : Codeception docs japanese translation">

    <link rel="stylesheet" type="text/css" media="screen" href="//piccagliani.github.io/Codeception.docs.ja_JP/stylesheets/stylesheet.css">

    <title>Codeception.docs.ja</title>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="inner">
        <a id="forkme_banner" href="https://github.com/piccagliani/Codeception.docs.ja_JP">View on GitHub</a>

        <h1 id="project_title">Codeception.docs.ja</h1>
        <h2 id="project_tagline">Codeception docs japanese translation</h2>

        <section id="downloads">
            <a class="zip_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/zipball/master">Download this project as a .zip file</a>
            <a class="tar_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/tarball/master">Download this project as a tar.gz file</a>
        </section>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
        <h1>Unit Tests</h1>

<p>Codeception uses PHPUnit as a backend for running tests. Thus, any PHPUnit test can be added to Codeception test suite and then executed.
If you ever wrote a PHPUnit test then do it just as you did before. 
Codeception adds some nice helpers to simplify common tasks.</p>

<p>The basics of unit tests are skipped here, instead you will get a basic knowledge of what features Codeception adds to unit tests.</p>

<p><strong>To say it again: you don&#39;t need to install PHPUnit to run its tests. Codeception can run them too.</strong></p>

<h2>Creating Test</h2>

<p>Codeception have nice generators to simplify test creation.
You can start with generating a classical PHPUnit test extending <code>\PHPUnit_Framework_TestCase</code> class.
This can be done by this command:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar generate:phpunit unit Example
</code></pre></div>
<p>Codeception has its addons to standard unit tests, so let&#39;s try them.
We need another command to create Codeception-powered unit tests.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar generate:test unit Example
</code></pre></div>
<p>Both tests will create a new <code>ExampleTest</code> file located in <code>tests/unit</code> directory.</p>

<p>A test created by <code>generate:test</code> command will look like this:</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Codeception\Util\Stub</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">\Codeception\TestCase\Test</span>
<span class="p">{</span>
   <span class="sd">/**</span>
<span class="sd">    * @var UnitTester</span>
<span class="sd">    */</span>
    <span class="k">protected</span> <span class="nv">$tester</span><span class="p">;</span>

    <span class="c1">// executed before each test</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_before</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="c1">// executed after each test</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_after</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>This class has predefined <code>_before</code> and <code>_after</code> methods to start with. You can use them to create a tested object before each test, and destroy it afterwards.</p>

<p>As you see, unlike in PHPUnit, <code>setUp</code> and <code>tearDown</code> methods are replaced with their aliases: <code>_before</code>, <code>_after</code>.</p>

<p>The actual <code>setUp</code> and <code>tearDown</code> were implemented by parent class <code>\Codeception\TestCase\Test</code> and set up the UnitTester class to have all the cool actions from Cept-files to be run as a part of unit tests. Just like in acceptance and functional tests you can choose the proper modules for <code>UnitTester</code> class in <code>unit.suite.yml</code> configuration file.</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># Codeception Test Suite Configuration</span>

<span class="c1"># suite for unit (internal) tests.</span>
<span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">UnitTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">UnitHelper</span><span class="p-Indicator">,</span> <span class="nv">Asserts</span><span class="p-Indicator">]</span>
</code></pre></div>
<h3>Classical Unit Testing</h3>

<p>Unit tests in Codeception are written in absolutely the same way as it is done in PHPUnit:</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">UserTest</span> <span class="k">extends</span> <span class="nx">\Codeception\TestCase\Test</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testValidation</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">();</span>

        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">]));</span>

        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;toolooooongnaaaaaaameeee&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">]));</span>

        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;davert&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">]));</span>           
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<h3>BDD Specification Testing</h3>

<p>When writing tests you should prepare them for constant changes in your application. Tests should be easy to read and maintain. If a specification to your application is changed, your tests should be updated as well. If you don&#39;t have a convention inside your team on documenting tests, you will have issues figuring out what tests were affected by introduction of a new feature.</p>

<p>That&#39;s why it&#39;s pretty important not just to cover your application with unit tests, but make unit tests self-explanatory. We do this for scenario-driven acceptance and functional tests, and we should do this for unit and integration tests as well.</p>

<p>For this case we have a stand-alone project <a href="https://github.com/Codeception/Specify">Specify</a> (which is included in phar package) for writing specifications inside unit tests.</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">UserTest</span> <span class="k">extends</span> <span class="nx">\Codeception\TestCase\Test</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">\Codeception\Specify</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testValidation</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">specify</span><span class="p">(</span><span class="s2">&quot;username is required&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">]));</span>
        <span class="p">});</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">specify</span><span class="p">(</span><span class="s2">&quot;username is too long&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;toolooooongnaaaaaaameeee&#39;</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">]));</span>
        <span class="p">});</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">specify</span><span class="p">(</span><span class="s2">&quot;username is ok&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;davert&#39;</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">]));</span>           
        <span class="p">});</span>     
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x">        </span>
</code></pre></div>
<p>Using <code>specify</code> codeblocks you can describe any piece of test. This makes tests much cleaner and understandable for everyone in your team.</p>

<p>Code inside <code>specify</code> blocks is isolated. In the example above any change to <code>$this-&gt;user</code> (as any other object property), will not be reflected in other code blocks.</p>

<p>Also you may add <a href="https://github.com/Codeception/Verify">Codeception\Verify</a> for BDD-style assertions. This tiny library adds more readable assertions, which is quite nice, if you are always confused of which argument in <code>assert</code> calls is expected and which one is actual.</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nx">verify</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">equals</span><span class="p">(</span><span class="s1">&#39;john&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<h2>Using Modules</h2>

<p>As in scenario-driven functional or acceptance tests you can access Actor class methods. If you write integration tests, it may be useful to include <code>Db</code> module for database testing. </p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># Codeception Test Suite Configuration</span>

<span class="c1"># suite for unit (internal) tests.</span>
<span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">UnitTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Db</span><span class="p-Indicator">,</span> <span class="nv">UnitHelper</span><span class="p-Indicator">]</span>
</code></pre></div>
<p>To access UnitTester methods you can use <code>UnitTester</code> property in a test.</p>

<h3>Testing Database</h3>

<p>Let&#39;s see how you can do some database testing:</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">testSavingUser</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;Miles&#39;</span><span class="p">);</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setSurname</span><span class="p">(</span><span class="s1">&#39;Davis&#39;</span><span class="p">);</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;Miles Davis&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getFullName</span><span class="p">());</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tester</span><span class="o">-&gt;</span><span class="na">seeInDatabase</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Miles&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Davis&#39;</span><span class="p">));</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Database will be cleaned and populated after each test, as it happens for acceptance and functional tests.
If it&#39;s not your required behavior, please change the settings of <code>Db</code> module for the current suite.</p>

<h3>Accessing Module</h3>

<p>Codeception allows you to access properties and methods of all modules defined for this suite. Unlike using the UnitTester class for this purpose, using module directly grants you access to all public properties of that module.</p>

<p>For example, if you use <code>Symfony2</code> module, here is the way you can access Symfony container:</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * @var Symfony\Component\DependencyInjection\Container</span>
<span class="sd"> */</span>
<span class="nv">$container</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getModule</span><span class="p">(</span><span class="s1">&#39;Symfony2&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">container</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>All public variables are listed in references for corresponding modules.</p>

<h3>Cest</h3>

<p>Alternatively to testcases extended from <code>PHPUnit_Framework_TestCase</code> you may use Codeception-specific Cest format. It does not require to be extended from any other class. All public methods of this class are tests.</p>

<p>The example above can be rewritten in scenario-driven manner like this:</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">UserCest</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateUser</span><span class="p">(</span><span class="nx">UnitTester</span> <span class="nv">$t</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$t</span><span class="o">-&gt;</span><span class="na">createUser</span><span class="p">();</span>
        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="nv">$t</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">]);</span> 

        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;toolooooongnaaaaaaameeee&#39;</span><span class="p">;</span>
        <span class="nv">$t</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">]));</span>

        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;davert&#39;</span><span class="p">;</span>
        <span class="nv">$t</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">]));</span>

        <span class="nv">$t</span><span class="o">-&gt;</span><span class="na">seeInDatabase</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Miles&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Davis&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>For unit testing you may include <code>Asserts</code> module, that adds regular assertions to UnitTester which you may access from <code>$t</code> variable.</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># Codeception Test Suite Configuration</span>

<span class="c1"># suite for unit (internal) tests.</span>
<span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">UnitTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Asserts</span><span class="p-Indicator">,</span> <span class="nv">Db</span><span class="p-Indicator">,</span> <span class="nv">UnitHelper</span><span class="p-Indicator">]</span>
</code></pre></div>
<p><a href="http://codeception.com/docs/07-AdvancedUsage#Cest-Classes">Learn more about Cest format</a>.</p>

<h3>Stubs</h3>

<p>Codeception provides a tiny wrapper over PHPUnit mocking framework to create stubs easily. Include <code>\Codeception\Util\Stub</code> to start creating dummy objects.</p>

<p>In this example we instantiate object without calling a constructor and replace <code>getName</code> method to return value <em>john</em>.</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nx">Stub</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;getName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;john&#39;</span><span class="p">]);</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span> <span class="c1">// &#39;john&#39;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Stubs are created with PHPUnit&#39;s mocking framework. Alternatively you can use <a href="https://github.com/padraic/mockery">Mockery</a> (with <a href="https://github.com/Codeception/MockeryModule">Mockery module</a>), <a href="https://github.com/Codeception/AspectMock">AspectMock</a> or others.</p>

<p>Full reference on Stub util class can be found <a href="/docs/reference/Stub">here</a>.</p>

<h2>Conclusion</h2>

<p>PHPUnit tests are first-class citizens in test suites. Whenever you need to write and execute unit tests, you don&#39;t need to install PHPUnit, but use Codeception to execute them. Some nice features can be added to common unit tests by integrating Codeception modules. For the most of unit and integration testing PHPUnit tests are just enough. They are fast and easy to maintain.</p>

    </section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="inner">
        <p class="copyright">Codeception.docs.ja maintained by <a href="https://github.com/piccagliani">piccagliani</a></p>
        <p>Last updated: 2015-02-20 16:41:43 +0900, Based on <a href="https://github.com/Codeception/Codeception/tree/2.0">Codeception</a>@4e267293bb</p>
        <div id="contributors"></div>
    </footer>
</div>

<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-59804278-1");
        pageTracker._trackPageview();
    } catch(err) {}
</script>
<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="//piccagliani.github.io/Codeception.docs.ja_JP/javascripts/contributors.js"></script>

</body>
</html>
